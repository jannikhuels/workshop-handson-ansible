- name: Uncompress JDK to /opt/
  unarchive: src=jdk-8u131-linux-x64.tar.gz dest=/opt/ group=ansible owner=ansible

- name: Create symlink
  file: src=/opt/jdk1.8.0_91 dest=/opt/jdk1.8 state=link owner=ansible group=ansible

- name: Install
  yum: name=/opt/jdk-8u131-linux-x64.tar.gz state=present

- name: Add Group for Keycloak User
  group: name=keycloak state=present
  become: true

- name: Create keycloak user
  user: name=keycloak group=keycloak state=present
  become: true

- name: Create symlink
  file: src=/opt/jdk1.8.0_131 dest=/opt/jdk1.8 state=link

- name: unarchive keycloak
  unarchive: src=keycloak-3.1.0.Final.tar.gz dest=/opt owner=keycloak group=keycloak mode=0755 copy=no

- name: Create Symlink to Keycloak Version
  file: path=/opt/keycloak src=/opt/keycloak-2.5.4.Final state=link force=yes

- name: keycloak log directory
  file: dest=/opt/keycloak/standalone/log
        mode=0755
        owner=keycloak
        group=keycloak
        state=directory

- name: keycloak data directory
  file: dest=/opt/keycloak/standalone/data
        mode=0755
        owner=keycloak
        group=keycloak
        state=directory

- name: keycloak tmp directory
  file: dest=/opt/keycloak/standalone/tmp
        mode=0755
        owner=keycloak
        group=keycloak
        state=directory

- name: keycloak deploy directory
  file: dest=/opt/keycloak/standalone/deployments
        mode=0755
        owner=keycloak
        group=keycloak
        state=directory

- name: make keycloak configuration directory readable
  file: dest=/opt/keycloak/standalone/configuration
        mode=0755
        owner=keycloak
        group=keycloak
        state=directory
        recurse=yes

- name: keycloak systemd setup
  template:
    owner=root group=root mode=0644
    src=keycloak.service
    dest=/etc/systemd/system/keycloak.service

- name: Create Keycloak Admin Account
  command: /opt/keycloak/bin/add-user-keycloak.sh -u admin -p admin
